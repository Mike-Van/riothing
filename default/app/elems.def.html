<def-button>
  <a href={opts.href}
    onclick={handleClick} 
    class="{
      'bd-w:1px bs:3 ts:all fw:600 ws:np hv-trl:0-1px hv-bs:2 hv-gs:10pc': true,
      'w:100pc':                      opts.full,
      'bg:sec c:white bd-c:sec':      !opts.bordered && !opts.white,
      'bg:ts c:sec bd-c:sec':         opts.bordered && !opts.white,
      'bg:white bd-c:sec c:sec':      opts.white,
      'p:10px-24px br:2px fs:90pc ls:2px':   !opts.big,
      'p:12px-30px br:5px fs:110pc ls:1.5px':  opts.big
    } {opts.classname}">
      <yield />{opts.text}
  </a>
  <script>
    //this.root.removeAttribute('class');
    this.handeClick = (e) => {
      e.preventUpdate = true;
      e.preventDefault();
      e.stopPropagation();
      opts.onclick(e);
    }
  </script>
</def-button>

<def-fog>
  <div onclick={opts.onclick} class="w:100pc h:100pc bg:whitea6 t,l:0 dp:flx ai:c jc:c z:20 {'ps:ab': !opts.fixed, 'ps:fx': opts.fixed}">
    <span if={opts.loading} class="br:100pc w,h:40px bg-c:sec an:scaler-1s-inf-eio" />
    <span if={opts.error} class="w:auto bd:1px-sld-red p:12px-24px m:10px mnw:200px bg:white br:2px bs:1px ta:l">
      <h2 class="m:12px-0">Error</h2>
      <p class="m:12px-0">{opts.error}</p>
      <div class="ta:r">
        <def-button text="close" />
      </div>
    </span>
  </div>
</def-fog>

<def-link>
  <a href={opts.href}
    onclick={opts.onclick} 
    class={
      'c:black td:ul': true
    }>
      {opts.text}
  </a>
</def-link>

<def-splash>
  <div class="ps:fx bs:5 of:auto z:2 ts:all {
    'op:0': !opts.page,
    'r:0 t:0': opts.right,
    'l:0 t:0': opts.left,
    'b:0 r:0': opts.down,
    't:0 r:0': opts.top,
    'tf:trx-100pc':   !opts.page && opts.right,
    'trx:100npc':  !opts.page && opts.left,
    'try:100pc':   !opts.page && opts.up,
    'tf:try-100npc':  !opts.page && opts.down,
  } {opts.classname}">

    <div class="h:100pc" if={opts.page}>
      <a href="/" class="fs:140pc p:20px-30px md-t,r:0 md-ps:ab mdx-ps:fx mdx-b,r:0 {
        'fu-arrow-right':  opts.right,
        'fu-arrow-up':     opts.down,
        'fu-arrow-down':   opts.up,
        'fu-arrow-left':   opts.left
      }" />
      
      <div if={false} class="dp:flx p:25px ai:c h:100pc">
        <yield/>
      </div>
      
      <div class="dp:flx p:25px ai:c h:100pc" state={opts.state} data-is={opts.view || 'page-' + opts.page} />
      
    </div>
  </div>
  <script>
    const { right, left, up, down, classname } = this.opts;
    if(!right && !left && !up && !down)
      this.opts.right = true;
    if(!classname)
      this.opts.classname = 'w,h:100pc mdx-w:100pc bg:white c:txt';
  </script>
</def-splash>

<def-input>
  <div>
    <input />
  </div>
</def-input>

<def-wrap style="width: 100%">
  <div class="w:100pc {'mxw:1100px p-rl:3pc': !opts.unlimited}">
    <def-opts if={!opts.include} class={opts.classname}>
      <yield />
    </def-opts>
    <div if={opts.include} 
      data-is={ opts.include } 
      opts={opts} 
      class="ts:all"
      classanim="op:0.5 trl:100npc-0 l:0 t:0 ps:ab z:9 w:100pc"
    />
  </div>
  <div if={false && opts.centered} class="w:100pc h:100vh p-rl:3pc dp:flx ai:c {'mxw:1100px p-rl:3pc': !opts.unlimited} {opts.class}">
    <div>
      <def-opts if={!opts.include} class={opts.classname}>
        <yield />
      </def-opts>
      <div if={opts.include} data-is={ opts.include } opts={opts} />
    </div>
  </div>
  <script>
    //this.root.removeAttribute('class');
    // this.on('update', data => console.log('wtf', data, this.opts))
  
    // Object.keys(this.parent).forEach( key => !this[key] ? this[key] = this.parent[key] : null );
    // Object.assign(this.opts, this.parent.opts);
    // this.shouldUpdate = (data, newOpts) => {
    //   Object.assign(this.opts, this.parent.opts);
    // }
  </script>
</def-wrap>

<def-raw>
  <script>
    if(this.opts.html)
      this.root.innerHTML = this.opts.html;
    
    return;
      
    this.escape = document.createElement('textarea');
    
    this.escapeHTML = (html) => {
      this.escape.textContent = html;
      return this.escape.innerHTML;
    }
    
    this.unescapeHTML = (html) => {
      this.escape.innerHTML = html;
      return this.escape.textContent;
    }
    
    if(this.opts.html)
      this.root.innerHTML = this.unescapeHTML(this.opts.html);
      
  </script>
</def-raw>

riot.tag('def-opts', false, function(opts){
  Object.keys(this.parent.parent).forEach( key => !this[key] ? this[key] = this.parent.parent[key] : null );
  Object.assign(this.opts, this.parent.parent.opts);
  
  this.shouldUpdate = (data, newOpts) => {
    Object.assign(this.opts, this.parent.parent.opts);
    Object.keys(this.parent.parent).forEach( key => !this[key] || this[key] !== this.parent.parent[key] ? this[key] = this.parent.parent[key] : null );
    return true;
  }
})